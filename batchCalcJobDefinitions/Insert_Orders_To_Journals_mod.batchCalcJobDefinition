<?xml version="1.0" encoding="UTF-8"?>
<BatchCalcJobDefinition xmlns="http://soap.sforce.com/2006/04/metadata">
    <datasources>
        <description>The Order object used as the data source for the request.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>Status</alias>
            <name>Status</name>
        </fields>
        <fields>
            <alias>Rebate</alias>
            <name>Rebate__c</name>
        </fields>
        <fields>
            <alias>AccountId</alias>
            <name>AccountId</name>
        </fields>
        <fields>
            <alias>ActivatedDate</alias>
            <name>ActivatedDate</name>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <name>EffectiveDate</name>
        </fields>
        <label>Order</label>
        <name>Order</name>
        <sourceName>Order</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Order Item object used as the data source for the request.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>Product2Id</alias>
            <name>Product2Id</name>
        </fields>
        <fields>
            <alias>OrderId</alias>
            <name>OrderId</name>
        </fields>
        <fields>
            <alias>TotalPrice</alias>
            <name>TotalPrice</name>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <name>Quantity</name>
        </fields>
        <label>Order Item</label>
        <name>OrderItem</name>
        <sourceName>OrderItem</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Rebate Program Member object used as the data source for the request.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <name>RebateProgramId</name>
        </fields>
        <fields>
            <alias>MemberStatus</alias>
            <name>MemberStatus</name>
        </fields>
        <fields>
            <alias>AccountId</alias>
            <name>AccountId</name>
        </fields>
        <label>Rebate Program Member</label>
        <name>RebateProgramMember</name>
        <sourceName>RebateProgramMember</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Transaction Journal object used as the data source for the request.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>MemberId</alias>
            <name>MemberId</name>
        </fields>
        <fields>
            <alias>ProductId</alias>
            <name>ProductId</name>
        </fields>
        <fields>
            <alias>TransactionAmount</alias>
            <name>TransactionAmount</name>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <name>Quantity</name>
        </fields>
        <fields>
            <alias>ActivityDate</alias>
            <name>ActivityDate</name>
        </fields>
        <fields>
            <alias>ExternalTransactionNumber</alias>
            <name>ExternalTransactionNumber</name>
        </fields>
        <label>TransactionJournal</label>
        <name>TransactionJournal</name>
        <sourceName>TransactionJournal</sourceName>
        <type>StandardObject</type>
    </datasources>
    <description>Filters orders that have been activated between the specified start and end dates for orgs where multi currency is disabled. The orders are inserted into the Transaction Journal object per rebate program.</description>
    <filters>
        <criteria>
            <inputVariable>StartDate</inputVariable>
            <operator>GreaterThanOrEquals</operator>
            <sequence>1</sequence>
            <sourceFieldName>ActivatedDate</sourceFieldName>
        </criteria>
        <criteria>
            <inputVariable>EndDate</inputVariable>
            <operator>LessThanOrEquals</operator>
            <sequence>2</sequence>
            <sourceFieldName>ActivatedDate</sourceFieldName>
        </criteria>
        <criteria>
            <operator>Equals</operator>
            <sequence>3</sequence>
            <sourceFieldName>Rebate</sourceFieldName>
            <value>true</value>
        </criteria>
        <description>Filters the orders that have been activated between the specified start date and end date.</description>
        <filterCondition>1 AND 2 AND 3</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Activated Orders</label>
        <name>FilterActivatedOrders</name>
        <sourceName>Order</sourceName>
    </filters>
    <filters>
        <criteria>
            <inputVariable>RebateProgramId</inputVariable>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>RebateProgramId</sourceFieldName>
        </criteria>
        <description>Filters the program members by the specified rebate program.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Program Members</label>
        <name>FilterProgramMembers</name>
        <sourceName>RebateProgramMember</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>IsNull</operator>
            <sequence>1</sequence>
            <sourceFieldName>ExternalTransactionNumber</sourceFieldName>
        </criteria>
        <description>Filters the order items from active orders for the specified program member to be inserted into the transaction journal.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Transaction Journals By Orders And Members</label>
        <name>FilterTransactionJournalsByOrdersAndMembers</name>
        <sourceName>OrderItemsForTransactionJournal</sourceName>
    </filters>
    <isTemplate>false</isTemplate>
    <joins>
        <description>Checks if the order items from active orders for the specified rebate program member are copied into the transaction journal.</description>
        <fields>
            <alias>AccountId</alias>
            <sourceFieldName>AccountId</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>ActivatedDate</alias>
            <sourceFieldName>ActivatedDate</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>ExternalTransactionNumber</alias>
            <sourceFieldName>ExternalTransactionNumber</sourceFieldName>
            <sourceName>TransactionJournal</sourceName>
        </fields>
        <fields>
            <alias>MemberId</alias>
            <sourceFieldName>MemberId</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>OrderId</alias>
            <sourceFieldName>OrderId</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>OrderItemId</alias>
            <sourceFieldName>OrderItemId</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>Product2Id</alias>
            <sourceFieldName>Product2Id</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <sourceFieldName>StartDate</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <fields>
            <alias>TotalPrice</alias>
            <sourceFieldName>TotalPrice</sourceFieldName>
            <sourceName>RebateProgramMembersForOrderItems</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>OrderItemId</primarySourceFieldName>
            <secondarySourceFieldName>ExternalTransactionNumber</secondarySourceFieldName>
        </joinKeys>
        <label>Order Items For Transaction Journal</label>
        <name>OrderItemsForTransactionJournal</name>
        <primarySourceName>RebateProgramMembersForOrderItems</primarySourceName>
        <secondarySourceName>TransactionJournal</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <joins>
        <description>Provides the order items from the active orders.</description>
        <fields>
            <alias>AccountId</alias>
            <sourceFieldName>AccountId</sourceFieldName>
            <sourceName>FilterActivatedOrders</sourceName>
        </fields>
        <fields>
            <alias>ActivatedDate</alias>
            <sourceFieldName>ActivatedDate</sourceFieldName>
            <sourceName>FilterActivatedOrders</sourceName>
        </fields>
        <fields>
            <alias>Id</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>FilterActivatedOrders</sourceName>
        </fields>
        <fields>
            <alias>OrderId</alias>
            <sourceFieldName>OrderId</sourceFieldName>
            <sourceName>OrderItem</sourceName>
        </fields>
        <fields>
            <alias>OrderItemId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>OrderItem</sourceName>
        </fields>
        <fields>
            <alias>Product2Id</alias>
            <sourceFieldName>Product2Id</sourceFieldName>
            <sourceName>OrderItem</sourceName>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
            <sourceName>OrderItem</sourceName>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <sourceFieldName>StartDate</sourceFieldName>
            <sourceName>FilterActivatedOrders</sourceName>
        </fields>
        <fields>
            <alias>TotalPrice</alias>
            <sourceFieldName>TotalPrice</sourceFieldName>
            <sourceName>OrderItem</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>OrderId</primarySourceFieldName>
            <secondarySourceFieldName>Id</secondarySourceFieldName>
        </joinKeys>
        <label>Order Items Plus Filter Activated Orders</label>
        <name>OrderItemsFromActiveOrders</name>
        <primarySourceName>OrderItem</primarySourceName>
        <secondarySourceName>FilterActivatedOrders</secondarySourceName>
        <type>Inner</type>
    </joins>
    <joins>
        <description>Provides the order items from active orders for the specified rebate program member.</description>
        <fields>
            <alias>AccountId</alias>
            <sourceFieldName>AccountId</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <fields>
            <alias>ActivatedDate</alias>
            <sourceFieldName>ActivatedDate</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <fields>
            <alias>MemberId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>FilterProgramMembers</sourceName>
        </fields>
        <fields>
            <alias>OrderId</alias>
            <sourceFieldName>OrderId</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <fields>
            <alias>OrderItemId</alias>
            <sourceFieldName>OrderItemId</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <fields>
            <alias>Product2Id</alias>
            <sourceFieldName>Product2Id</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <sourceFieldName>StartDate</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <fields>
            <alias>TotalPrice</alias>
            <sourceFieldName>TotalPrice</sourceFieldName>
            <sourceName>OrderItemsFromActiveOrders</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>AccountId</primarySourceFieldName>
            <secondarySourceFieldName>AccountId</secondarySourceFieldName>
        </joinKeys>
        <label>Rebate Program Members For Order Items</label>
        <name>RebateProgramMembersForOrderItems</name>
        <primarySourceName>OrderItemsFromActiveOrders</primarySourceName>
        <secondarySourceName>FilterProgramMembers</secondarySourceName>
        <type>Inner</type>
    </joins>
    <label>Insert Orders To Journals mod</label>
    <parameters>
        <dataType>DateTime</dataType>
        <description>The end date for filtering orders that are activated.</description>
        <isMultiValue>false</isMultiValue>
        <label>End Date</label>
        <name>EndDate</name>
    </parameters>
    <parameters>
        <dataType>Text</dataType>
        <description>ID of the rebate program to insert orders for.</description>
        <isMultiValue>false</isMultiValue>
        <label>Rebate Program Id</label>
        <name>RebateProgramId</name>
    </parameters>
    <parameters>
        <dataType>DateTime</dataType>
        <description>The start date for filtering orders that are activated.</description>
        <isMultiValue>false</isMultiValue>
        <label>Start Date</label>
        <name>StartDate</name>
    </parameters>
    <processType>DataProcessingEngine</processType>
    <status>Active</status>
    <transforms>
        <description>Calculate the activity date of the processed orders from the inserted transaction journal records of active orders for the specified rebate program member.</description>
        <expressionFields>
            <alias>ActivityDate</alias>
            <dataType>DateTime</dataType>
            <expression>DATETIMEVALUE({StartDate},&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSZ&quot;)</expression>
        </expressionFields>
        <label>Calculate Activity Date For Processed Orders</label>
        <name>CalculateActivityDateForProcessedOrders</name>
        <sourceName>FilterTransactionJournalsByOrdersAndMembers</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <writebacks>
        <description>Inserts the orders calculated from the list of active orders for the specified rebate program member into the transaction journal.</description>
        <fields>
            <sourceFieldName>TotalPrice</sourceFieldName>
            <targetFieldName>TransactionAmount</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>Quantity</sourceFieldName>
            <targetFieldName>Quantity</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>MemberId</sourceFieldName>
            <targetFieldName>MemberId</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>Product2Id</sourceFieldName>
            <targetFieldName>ProductId</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>ActivityDate</sourceFieldName>
            <targetFieldName>ActivityDate</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>OrderId</sourceFieldName>
            <targetFieldName>OrderId</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>OrderItemId</sourceFieldName>
            <targetFieldName>OrderItemId</targetFieldName>
        </fields>
        <isChangedRow>false</isChangedRow>
        <label>Insert Order Items</label>
        <name>InsertOrderItems</name>
        <operationType>Insert</operationType>
        <sourceName>CalculateActivityDateForProcessedOrders</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>TransactionJournal</targetObjectName>
        <writebackSequence>1</writebackSequence>
        <writebackUser>005Hr00000EirARIAZ</writebackUser>
    </writebacks>
</BatchCalcJobDefinition>
