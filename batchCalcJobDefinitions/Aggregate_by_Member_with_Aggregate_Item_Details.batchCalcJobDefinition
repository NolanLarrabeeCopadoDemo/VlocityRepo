<?xml version="1.0" encoding="UTF-8"?>
<BatchCalcJobDefinition xmlns="http://soap.sforce.com/2006/04/metadata">
    <aggregates>
        <description>Calculates the total transaction amount and total quantity on the FilterTransactionJournalsWithValidActivityDates node. The results are grouped by each member, rebate type, and payout period.</description>
        <fields>
            <aggregateFunction>Sum</aggregateFunction>
            <alias>TotalAggAmount</alias>
            <sourceFieldName>TransactionAmount</sourceFieldName>
        </fields>
        <fields>
            <aggregateFunction>Sum</aggregateFunction>
            <alias>TotalAggQuanity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
        </fields>
        <groupBy>MemberId</groupBy>
        <groupBy>RebateTypeId</groupBy>
        <groupBy>PayoutPeriodId</groupBy>
        <label>Total Transaction Amount and Total Quantity</label>
        <name>TotalTransactionAmountAndTotalQuantity</name>
        <sourceName>FilterValidTransactionJournalsForRebateTypes</sourceName>
    </aggregates>
    <datasources>
        <description>The Program Rebate Type object as the data source.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <name>RebateProgramId</name>
        </fields>
        <fields>
            <alias>Status</alias>
            <name>Status</name>
        </fields>
        <fields>
            <alias>CalcObjectId</alias>
            <name>CalcObjectId</name>
        </fields>
        <fields>
            <alias>FilterCriteria</alias>
            <name>FilterCriteria</name>
        </fields>
        <fields>
            <alias>ProductFilterType</alias>
            <name>ProductFilterType</name>
        </fields>
        <label>Program Rebate Type</label>
        <name>ProgramRebateType</name>
        <sourceName>ProgramRebateType</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Program Rebate Type Product object as the data source.</description>
        <fields>
            <alias>ProductId</alias>
            <name>ProductId</name>
        </fields>
        <fields>
            <alias>ProgramRebateTypeId</alias>
            <name>ProgramRebateTypeId</name>
        </fields>
        <fields>
            <alias>ProgramRebateTypeProductId</alias>
            <name>Id</name>
        </fields>
        <label>Program Rebate Type Product</label>
        <name>ProgramRebateTypeProduct</name>
        <sourceName>ProgramRebateTypeProduct</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Rebate Member Aggregate Item object is used as the data source.</description>
        <fields>
            <alias>RebateMemberProductAggregateId</alias>
            <name>RebateMemberProductAggregateId</name>
        </fields>
        <fields>
            <alias>RebateMemberAggregateItemId</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>TransactionJournalId</alias>
            <name>TransactionJournalId</name>
        </fields>
        <fields>
            <alias>TransactionAmount</alias>
            <name>TransactionAmount</name>
        </fields>
        <fields>
            <alias>TransactionQuantity</alias>
            <name>TransactionQuantity</name>
        </fields>
        <label>Rebate Member Aggregate Item</label>
        <name>RebateMemberAggregateItem</name>
        <sourceName>RebateMemberAggregateItem</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Rebate Member Product Aggregate object as the data source.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>ProgramRebateTypeId</alias>
            <name>ProgramRebateTypeId</name>
        </fields>
        <fields>
            <alias>RebateProgramMemberId</alias>
            <name>RebateProgramMemberId</name>
        </fields>
        <fields>
            <alias>RebateProgramPayoutPeriodId</alias>
            <name>RebateProgramPayoutPeriodId</name>
        </fields>
        <fields>
            <alias>TotalQuantity</alias>
            <name>TotalQuantity</name>
        </fields>
        <fields>
            <alias>TotalTransactionAmount</alias>
            <name>TotalTransactionAmount</name>
        </fields>
        <fields>
            <alias>AggregateReferenceNumber</alias>
            <name>AggregateReferenceNumber</name>
        </fields>
        <label>Rebate Member Product Aggregate</label>
        <name>RebateMemberProductAggregate</name>
        <sourceName>RebateMemberProductAggregate</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Rebate Program object as the data source.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>Status</alias>
            <name>Status</name>
        </fields>
        <label>Rebate Program</label>
        <name>RebateProgram</name>
        <sourceName>RebateProgram</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Rebate Program Member object as the data source.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <name>RebateProgramId</name>
        </fields>
        <fields>
            <alias>MemberStatus</alias>
            <name>MemberStatus</name>
        </fields>
        <label>Rebate Program Member</label>
        <name>RebateProgramMember</name>
        <sourceName>RebateProgramMember</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Rebate Program Payout Period object as the data source.</description>
        <fields>
            <alias>Id</alias>
            <name>Id</name>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <name>RebateProgramId</name>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <name>StartDate</name>
        </fields>
        <fields>
            <alias>EndDate</alias>
            <name>EndDate</name>
        </fields>
        <fields>
            <alias>Status</alias>
            <name>Status</name>
        </fields>
        <label>Rebate Program Payout Period</label>
        <name>RebateProgramPayoutPeriod</name>
        <sourceName>RebateProgramPayoutPeriod</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The Transaction Journal object as the data source.</description>
        <fields>
            <alias>MemberId</alias>
            <name>MemberId</name>
        </fields>
        <fields>
            <alias>ProductId</alias>
            <name>ProductId</name>
        </fields>
        <fields>
            <alias>TransactionAmount</alias>
            <name>TransactionAmount</name>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <name>Quantity</name>
        </fields>
        <fields>
            <alias>ActivityDate</alias>
            <name>ActivityDate</name>
        </fields>
        <fields>
            <alias>CreatedById</alias>
            <name>CreatedById</name>
        </fields>
        <fields>
            <alias>CreatedDate</alias>
            <name>CreatedDate</name>
        </fields>
        <fields>
            <alias>OrderId</alias>
            <name>OrderId</name>
        </fields>
        <fields>
            <alias>ExternalTransactionNumber</alias>
            <name>ExternalTransactionNumber</name>
        </fields>
        <fields>
            <alias>JournalDate</alias>
            <name>JournalDate</name>
        </fields>
        <fields>
            <alias>LastModifiedDate</alias>
            <name>LastModifiedDate</name>
        </fields>
        <fields>
            <alias>OrderItemId</alias>
            <name>OrderItemId</name>
        </fields>
        <fields>
            <alias>ProductCategoryId</alias>
            <name>ProductCategoryId</name>
        </fields>
        <fields>
            <alias>QuantityUnitOfMeasureId</alias>
            <name>QuantityUnitOfMeasureId</name>
        </fields>
        <fields>
            <alias>UsageType</alias>
            <name>UsageType</name>
        </fields>
        <fields>
            <alias>TransactionJournalId</alias>
            <name>Id</name>
        </fields>
        <label>Transaction Journal</label>
        <name>TransactionJournal</name>
        <sourceName>TransactionJournal</sourceName>
        <type>StandardObject</type>
    </datasources>
    <description>Uses the Member field on Transaction Journal to filter and aggregate transaction journal records. Upserts the aggregated records in the Rebate Member Product Aggregate object and qualified journal records in the Rebate Member Aggregate Item object.</description>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>MemberStatus</sourceFieldName>
            <value>Active</value>
        </criteria>
        <description>Filters records by active rebate program members.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Active Rebate Program Members</label>
        <name>FilterActiveRebateProgramMembers</name>
        <sourceName>FilterRebateProgramMember</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>Status</sourceFieldName>
            <value>Active</value>
        </criteria>
        <description>Filters records by active rebate program payout periods.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Active Rebate Program Payout Periods</label>
        <name>FilterActiveRebateProgramPayoutPeriods</name>
        <sourceName>FilterRebateProgramPayoutPeriod</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>Status</sourceFieldName>
            <value>Active</value>
        </criteria>
        <description>Filters records by active rebate programs.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Active Rebate Programs</label>
        <name>FilterActiveRebatePrograms</name>
        <sourceName>FilterRebatePrograms</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>Status</sourceFieldName>
            <value>Active</value>
        </criteria>
        <criteria>
            <inputVariable>BatchCalcJobDefinitionId</inputVariable>
            <operator>Equals</operator>
            <sequence>2</sequence>
            <sourceFieldName>CalcObjectId</sourceFieldName>
        </criteria>
        <description>Filters records by active rebate types.</description>
        <filterCondition>1 AND 2</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Active Rebate Types</label>
        <name>FilterActiveRebateTypes</name>
        <sourceName>FilterProgramRebateType</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>UsageType</sourceFieldName>
            <value>Rebates</value>
        </criteria>
        <description>Filters the transaction journal records by usage type.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Journals By Usage Type</label>
        <name>FilterJournalsByUsageType</name>
        <sourceName>TransactionJournal</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>IsNull</operator>
            <sequence>1</sequence>
            <sourceFieldName>ProductFilterType</sourceFieldName>
        </criteria>
        <criteria>
            <operator>Equals</operator>
            <sequence>2</sequence>
            <sourceFieldName>ProductFilterType</sourceFieldName>
            <value>IncludeProducts</value>
        </criteria>
        <criteria>
            <operator>IsNotNull</operator>
            <sequence>3</sequence>
            <sourceFieldName>ProgramRebateTypeProductId</sourceFieldName>
        </criteria>
        <criteria>
            <operator>Equals</operator>
            <sequence>4</sequence>
            <sourceFieldName>ProductFilterType</sourceFieldName>
            <value>ExcludeProducts</value>
        </criteria>
        <criteria>
            <operator>IsNull</operator>
            <sequence>5</sequence>
            <sourceFieldName>ProgramRebateTypeProductId</sourceFieldName>
        </criteria>
        <filterCondition>1 OR ( 2 AND 3) OR ( 4 AND 5)</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Journals For Valid Products</label>
        <name>FilterJournalsForValidProducts</name>
        <sourceName>ValidActivityDatedJournalsWithProgramRebateTypeProduct</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>IsUpdateOrNew</sourceFieldName>
            <value>1</value>
        </criteria>
        <description>Filters valid new or updated records to be upserted into the Rebate Program Member Aggregate object.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter New or Updated Aggregate Records</label>
        <name>FilterNewOrUpdatedAggregateRecords</name>
        <sourceName>CompareGeneratedAndExistingAggregateReferenceNumber</sourceName>
    </filters>
    <filters>
        <description>Filters records by the specified program rebate type.</description>
        <filterParameterName>ProgramRebateTypeFilter</filterParameterName>
        <isDynamicFilter>true</isDynamicFilter>
        <label>Filter Program Rebate Type</label>
        <name>FilterProgramRebateType</name>
        <sourceName>ProgramRebateType</sourceName>
    </filters>
    <filters>
        <description>Filters records by the specified rebate program member.</description>
        <filterParameterName>RebateProgramMemberFilter</filterParameterName>
        <isDynamicFilter>true</isDynamicFilter>
        <label>Filter Rebate Program Member</label>
        <name>FilterRebateProgramMember</name>
        <sourceName>RebateProgramMember</sourceName>
    </filters>
    <filters>
        <description>Filters records by the specified rebate program payout period.</description>
        <filterParameterName>RebateProgramPayoutPeriodFilter</filterParameterName>
        <isDynamicFilter>true</isDynamicFilter>
        <label>Filter Rebate Program Payout Period</label>
        <name>FilterRebateProgramPayoutPeriod</name>
        <sourceName>RebateProgramPayoutPeriod</sourceName>
    </filters>
    <filters>
        <description>Filters records by the specified rebate program.</description>
        <filterParameterName>RebateProgramFilter</filterParameterName>
        <isDynamicFilter>true</isDynamicFilter>
        <label>Filter Rebate Programs</label>
        <name>FilterRebatePrograms</name>
        <sourceName>RebateProgram</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>IsValid</sourceFieldName>
            <value>1</value>
        </criteria>
        <description>Filters the valid records in the Transaction Journals for the valid activity dates.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Transaction Journals With Valid Activity Dates</label>
        <name>FilterTransactionJournalsWithValidActivityDates</name>
        <sourceName>ComputeTransactionJournalsWithActivityDates</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>IsNull</operator>
            <sequence>1</sequence>
            <sourceFieldName>TransactionJournalIdFromAggregateItem</sourceFieldName>
        </criteria>
        <criteria>
            <operator>IsNotNull</operator>
            <sequence>2</sequence>
            <sourceFieldName>AggregateReferenceNumber</sourceFieldName>
        </criteria>
        <description>Filters the transaction journal records for valid aggregate item records.</description>
        <filterCondition>1 AND 2</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Valid Aggregate Item</label>
        <name>FilterValidAggregateItem</name>
        <sourceName>ValidTransactionJournalsForAggregateItem</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>IsValidForFilter</sourceFieldName>
            <value>true</value>
        </criteria>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Valid Transaction Journals For Rebate Types</label>
        <name>FilterValidTransactionJournalsForRebateTypes</name>
        <sourceName>ComputeValidTransactionJournalsPerRebateType</sourceName>
    </filters>
    <isTemplate>false</isTemplate>
    <joins>
        <description>Provides active program rebate types of active rebate programs.</description>
        <fields>
            <alias>FilterCriteria</alias>
            <sourceFieldName>FilterCriteria</sourceFieldName>
            <sourceName>FilterActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>ProductFilterType</alias>
            <sourceFieldName>ProductFilterType</sourceFieldName>
            <sourceName>FilterActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <sourceFieldName>RebateProgramId</sourceFieldName>
            <sourceName>FilterActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>RebateTypeId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>FilterActiveRebateTypes</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>Id</primarySourceFieldName>
            <secondarySourceFieldName>RebateProgramId</secondarySourceFieldName>
        </joinKeys>
        <label>Active Program Rebate Type for Rebate Programs</label>
        <name>ActiveProgramRebateTypeForRebatePrograms</name>
        <primarySourceName>FilterActiveRebatePrograms</primarySourceName>
        <secondarySourceName>FilterActiveRebateTypes</secondarySourceName>
        <type>Inner</type>
    </joins>
    <joins>
        <description>Adds rebate type and payout period information to the transaction journal data.</description>
        <fields>
            <alias>ActivityDate</alias>
            <sourceFieldName>ActivityDate</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>CreatedById</alias>
            <sourceFieldName>CreatedById</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>CreatedDate</alias>
            <sourceFieldName>CreatedDate</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>EndDate</alias>
            <sourceFieldName>EndDate</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>ExternalTransactionNumber</alias>
            <sourceFieldName>ExternalTransactionNumber</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>FilterCriteria</alias>
            <sourceFieldName>FilterCriteria</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>JournalDate</alias>
            <sourceFieldName>JournalDate</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>LastModifiedDate</alias>
            <sourceFieldName>LastModifiedDate</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>MemberId</alias>
            <sourceFieldName>MemberId</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>OrderId</alias>
            <sourceFieldName>OrderId</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>OrderItemId</alias>
            <sourceFieldName>OrderItemId</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>PayoutPeriodId</alias>
            <sourceFieldName>PayoutPeriodId</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>ProductCategoryId</alias>
            <sourceFieldName>ProductCategoryId</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>ProductFilterType</alias>
            <sourceFieldName>ProductFilterType</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>ProductId</alias>
            <sourceFieldName>ProductId</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>QuantityUnitOfMeasureId</alias>
            <sourceFieldName>QuantityUnitOfMeasureId</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <sourceFieldName>RebateProgramId</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>RebateTypeId</alias>
            <sourceFieldName>RebateTypeId</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <sourceFieldName>StartDate</sourceFieldName>
            <sourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>TransactionAmount</alias>
            <sourceFieldName>TransactionAmount</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>TransactionJournalId</alias>
            <sourceFieldName>TransactionJournalId</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <fields>
            <alias>UsageType</alias>
            <sourceFieldName>UsageType</sourceFieldName>
            <sourceName>FilterJournalsByUsageType</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>MemberId</primarySourceFieldName>
            <secondarySourceFieldName>MemberId</secondarySourceFieldName>
        </joinKeys>
        <label>Add Rebate Type and Payout Period to Transaction Journals</label>
        <name>AddRebateTypeAndPayoutPeriodToTransactionJournal</name>
        <primarySourceName>FilterJournalsByUsageType</primarySourceName>
        <secondarySourceName>ProgramMembersForActiveRebateTypeAndPayoutPeriods</secondarySourceName>
        <type>Inner</type>
    </joins>
    <joins>
        <description>Looks up any previously computed aggregate data for the newly aggregated record.</description>
        <fields>
            <alias>AggregateReferenceNumber</alias>
            <sourceFieldName>AggregateReferenceNumber</sourceFieldName>
            <sourceName>RebateMemberProductAggregate</sourceName>
        </fields>
        <fields>
            <alias>Id</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>RebateMemberProductAggregate</sourceName>
        </fields>
        <fields>
            <alias>MemberId</alias>
            <sourceFieldName>MemberId</sourceFieldName>
            <sourceName>TotalTransactionAmountAndTotalQuantity</sourceName>
        </fields>
        <fields>
            <alias>PayoutPeriodId</alias>
            <sourceFieldName>PayoutPeriodId</sourceFieldName>
            <sourceName>TotalTransactionAmountAndTotalQuantity</sourceName>
        </fields>
        <fields>
            <alias>RebateTypeId</alias>
            <sourceFieldName>RebateTypeId</sourceFieldName>
            <sourceName>TotalTransactionAmountAndTotalQuantity</sourceName>
        </fields>
        <fields>
            <alias>TotalAggAmount</alias>
            <sourceFieldName>TotalAggAmount</sourceFieldName>
            <sourceName>TotalTransactionAmountAndTotalQuantity</sourceName>
        </fields>
        <fields>
            <alias>TotalAggQuanity</alias>
            <sourceFieldName>TotalAggQuanity</sourceFieldName>
            <sourceName>TotalTransactionAmountAndTotalQuantity</sourceName>
        </fields>
        <fields>
            <alias>TotalQuantity</alias>
            <sourceFieldName>TotalQuantity</sourceFieldName>
            <sourceName>RebateMemberProductAggregate</sourceName>
        </fields>
        <fields>
            <alias>TotalTransactionAmount</alias>
            <sourceFieldName>TotalTransactionAmount</sourceFieldName>
            <sourceName>RebateMemberProductAggregate</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>MemberId</primarySourceFieldName>
            <secondarySourceFieldName>RebateProgramMemberId</secondarySourceFieldName>
        </joinKeys>
        <joinKeys>
            <primarySourceFieldName>PayoutPeriodId</primarySourceFieldName>
            <secondarySourceFieldName>RebateProgramPayoutPeriodId</secondarySourceFieldName>
        </joinKeys>
        <joinKeys>
            <primarySourceFieldName>RebateTypeId</primarySourceFieldName>
            <secondarySourceFieldName>ProgramRebateTypeId</secondarySourceFieldName>
        </joinKeys>
        <label>Look Up Existing Aggregate Data</label>
        <name>LookUpExistingAggregateData</name>
        <primarySourceName>TotalTransactionAmountAndTotalQuantity</primarySourceName>
        <secondarySourceName>RebateMemberProductAggregate</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <joins>
        <description>Provides the valid program members for the selected active rebate types and payout periods.</description>
        <fields>
            <alias>EndDate</alias>
            <sourceFieldName>EndDate</sourceFieldName>
            <sourceName>ValidPayoutPeriodForActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>FilterCriteria</alias>
            <sourceFieldName>FilterCriteria</sourceFieldName>
            <sourceName>ValidPayoutPeriodForActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>MemberId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>FilterActiveRebateProgramMembers</sourceName>
        </fields>
        <fields>
            <alias>PayoutPeriodId</alias>
            <sourceFieldName>PayoutPeriodId</sourceFieldName>
            <sourceName>ValidPayoutPeriodForActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>ProductFilterType</alias>
            <sourceFieldName>ProductFilterType</sourceFieldName>
            <sourceName>ValidPayoutPeriodForActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <sourceFieldName>RebateProgramId</sourceFieldName>
            <sourceName>ValidPayoutPeriodForActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>RebateTypeId</alias>
            <sourceFieldName>RebateTypeId</sourceFieldName>
            <sourceName>ValidPayoutPeriodForActiveRebateTypes</sourceName>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <sourceFieldName>StartDate</sourceFieldName>
            <sourceName>ValidPayoutPeriodForActiveRebateTypes</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>RebateProgramId</primarySourceFieldName>
            <secondarySourceFieldName>RebateProgramId</secondarySourceFieldName>
        </joinKeys>
        <label>Program Members for Active Rebate Type and Payout Periods</label>
        <name>ProgramMembersForActiveRebateTypeAndPayoutPeriods</name>
        <primarySourceName>ValidPayoutPeriodForActiveRebateTypes</primarySourceName>
        <secondarySourceName>FilterActiveRebateProgramMembers</secondarySourceName>
        <type>Inner</type>
    </joins>
    <joins>
        <description>Provides the valid transaction journal records with aggregate records having a reference number.</description>
        <fields>
            <alias>AggregateId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>CompareGeneratedAndExistingAggregateReferenceNumber</sourceName>
        </fields>
        <fields>
            <alias>AggregateReferenceNumber</alias>
            <sourceFieldName>GeneratedAggregateReferenceNumber</sourceFieldName>
            <sourceName>CompareGeneratedAndExistingAggregateReferenceNumber</sourceName>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>TransactionAmount</alias>
            <sourceFieldName>TransactionAmount</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>TransactionJournalId</alias>
            <sourceFieldName>TransactionJournalId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>MemberId</primarySourceFieldName>
            <secondarySourceFieldName>MemberId</secondarySourceFieldName>
        </joinKeys>
        <joinKeys>
            <primarySourceFieldName>PayoutPeriodId</primarySourceFieldName>
            <secondarySourceFieldName>PayoutPeriodId</secondarySourceFieldName>
        </joinKeys>
        <joinKeys>
            <primarySourceFieldName>RebateTypeId</primarySourceFieldName>
            <secondarySourceFieldName>RebateTypeId</secondarySourceFieldName>
        </joinKeys>
        <label>Transaction Journal with Aggregate Reference Number</label>
        <name>TransactionJournalWithAggregateReferenceNumber</name>
        <primarySourceName>FilterTransactionJournalsWithValidActivityDates</primarySourceName>
        <secondarySourceName>CompareGeneratedAndExistingAggregateReferenceNumber</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <joins>
        <fields>
            <alias>ActivityDate</alias>
            <sourceFieldName>ActivityDate</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>CreatedById</alias>
            <sourceFieldName>CreatedById</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>CreatedDate</alias>
            <sourceFieldName>CreatedDate</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>EndDate</alias>
            <sourceFieldName>EndDate</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>ExternalTransactionNumber</alias>
            <sourceFieldName>ExternalTransactionNumber</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>FilterCriteria</alias>
            <sourceFieldName>FilterCriteria</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>IsValid</alias>
            <sourceFieldName>IsValid</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>JournalDate</alias>
            <sourceFieldName>JournalDate</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>LastModifiedDate</alias>
            <sourceFieldName>LastModifiedDate</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>MemberId</alias>
            <sourceFieldName>MemberId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>OrderId</alias>
            <sourceFieldName>OrderId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>OrderItemId</alias>
            <sourceFieldName>OrderItemId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>PayoutPeriodId</alias>
            <sourceFieldName>PayoutPeriodId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>ProductCategoryId</alias>
            <sourceFieldName>ProductCategoryId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>ProductFilterType</alias>
            <sourceFieldName>ProductFilterType</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>ProductId</alias>
            <sourceFieldName>ProductId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>ProgramRebateTypeProductId</alias>
            <sourceFieldName>ProgramRebateTypeProductId</sourceFieldName>
            <sourceName>ProgramRebateTypeProduct</sourceName>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>QuantityUnitOfMeasureId</alias>
            <sourceFieldName>QuantityUnitOfMeasureId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <sourceFieldName>RebateProgramId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>RebateTypeId</alias>
            <sourceFieldName>RebateTypeId</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <sourceFieldName>StartDate</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>TransactionAmount</alias>
            <sourceFieldName>TransactionAmount</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <fields>
            <alias>UsageType</alias>
            <sourceFieldName>UsageType</sourceFieldName>
            <sourceName>FilterTransactionJournalsWithValidActivityDates</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>ProductId</primarySourceFieldName>
            <secondarySourceFieldName>ProductId</secondarySourceFieldName>
        </joinKeys>
        <joinKeys>
            <primarySourceFieldName>RebateTypeId</primarySourceFieldName>
            <secondarySourceFieldName>ProgramRebateTypeId</secondarySourceFieldName>
        </joinKeys>
        <label>Valid Activity Dated Journals with Program Rebate Type Product</label>
        <name>ValidActivityDatedJournalsWithProgramRebateTypeProduct</name>
        <primarySourceName>FilterTransactionJournalsWithValidActivityDates</primarySourceName>
        <secondarySourceName>ProgramRebateTypeProduct</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <joins>
        <description>Provides valid payout periods for the selected active rebate types.</description>
        <fields>
            <alias>EndDate</alias>
            <sourceFieldName>EndDate</sourceFieldName>
            <sourceName>FilterActiveRebateProgramPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>FilterCriteria</alias>
            <sourceFieldName>FilterCriteria</sourceFieldName>
            <sourceName>ActiveProgramRebateTypeForRebatePrograms</sourceName>
        </fields>
        <fields>
            <alias>PayoutPeriodId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>FilterActiveRebateProgramPayoutPeriods</sourceName>
        </fields>
        <fields>
            <alias>ProductFilterType</alias>
            <sourceFieldName>ProductFilterType</sourceFieldName>
            <sourceName>ActiveProgramRebateTypeForRebatePrograms</sourceName>
        </fields>
        <fields>
            <alias>RebateProgramId</alias>
            <sourceFieldName>RebateProgramId</sourceFieldName>
            <sourceName>ActiveProgramRebateTypeForRebatePrograms</sourceName>
        </fields>
        <fields>
            <alias>RebateTypeId</alias>
            <sourceFieldName>RebateTypeId</sourceFieldName>
            <sourceName>ActiveProgramRebateTypeForRebatePrograms</sourceName>
        </fields>
        <fields>
            <alias>StartDate</alias>
            <sourceFieldName>StartDate</sourceFieldName>
            <sourceName>FilterActiveRebateProgramPayoutPeriods</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>RebateProgramId</primarySourceFieldName>
            <secondarySourceFieldName>RebateProgramId</secondarySourceFieldName>
        </joinKeys>
        <label>Valid Payout Period for Active Rebate Types</label>
        <name>ValidPayoutPeriodForActiveRebateTypes</name>
        <primarySourceName>ActiveProgramRebateTypeForRebatePrograms</primarySourceName>
        <secondarySourceName>FilterActiveRebateProgramPayoutPeriods</secondarySourceName>
        <type>Inner</type>
    </joins>
    <joins>
        <description>Provides the valid transaction journal records with aggregate item records.</description>
        <fields>
            <alias>AggregateId</alias>
            <sourceFieldName>AggregateId</sourceFieldName>
            <sourceName>TransactionJournalWithAggregateReferenceNumber</sourceName>
        </fields>
        <fields>
            <alias>AggregateReferenceNumber</alias>
            <sourceFieldName>AggregateReferenceNumber</sourceFieldName>
            <sourceName>TransactionJournalWithAggregateReferenceNumber</sourceName>
        </fields>
        <fields>
            <alias>Quantity</alias>
            <sourceFieldName>Quantity</sourceFieldName>
            <sourceName>TransactionJournalWithAggregateReferenceNumber</sourceName>
        </fields>
        <fields>
            <alias>RebateMemberAggregateItemId</alias>
            <sourceFieldName>RebateMemberAggregateItemId</sourceFieldName>
            <sourceName>RebateMemberAggregateItem</sourceName>
        </fields>
        <fields>
            <alias>RebateMemberProductAggregateId</alias>
            <sourceFieldName>RebateMemberProductAggregateId</sourceFieldName>
            <sourceName>RebateMemberAggregateItem</sourceName>
        </fields>
        <fields>
            <alias>TransactionAmount</alias>
            <sourceFieldName>TransactionAmount</sourceFieldName>
            <sourceName>TransactionJournalWithAggregateReferenceNumber</sourceName>
        </fields>
        <fields>
            <alias>TransactionAmountFromAggregateItem</alias>
            <sourceFieldName>TransactionAmount</sourceFieldName>
            <sourceName>RebateMemberAggregateItem</sourceName>
        </fields>
        <fields>
            <alias>TransactionJournalId</alias>
            <sourceFieldName>TransactionJournalId</sourceFieldName>
            <sourceName>TransactionJournalWithAggregateReferenceNumber</sourceName>
        </fields>
        <fields>
            <alias>TransactionJournalIdFromAggregateItem</alias>
            <sourceFieldName>TransactionJournalId</sourceFieldName>
            <sourceName>RebateMemberAggregateItem</sourceName>
        </fields>
        <fields>
            <alias>TransactionQuantityFromAggregateItem</alias>
            <sourceFieldName>TransactionQuantity</sourceFieldName>
            <sourceName>RebateMemberAggregateItem</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>AggregateId</primarySourceFieldName>
            <secondarySourceFieldName>RebateMemberProductAggregateId</secondarySourceFieldName>
        </joinKeys>
        <joinKeys>
            <primarySourceFieldName>TransactionJournalId</primarySourceFieldName>
            <secondarySourceFieldName>TransactionJournalId</secondarySourceFieldName>
        </joinKeys>
        <label>Valid Transaction Journals for Aggregate Item</label>
        <name>ValidTransactionJournalsForAggregateItem</name>
        <primarySourceName>TransactionJournalWithAggregateReferenceNumber</primarySourceName>
        <secondarySourceName>RebateMemberAggregateItem</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <label>Aggregate by Member with Aggregate Item Details</label>
    <parameters>
        <dataType>Text</dataType>
        <description>ID of the Data Processing Engine Definition that’s  provided as a parameter.</description>
        <isMultiValue>false</isMultiValue>
        <label>Data Processing Engine Definition Id</label>
        <name>BatchCalcJobDefinitionId</name>
    </parameters>
    <parameters>
        <dataType>Filter</dataType>
        <defaultValue>{&quot;filterCondition&quot;: &quot;1&quot;,&quot;criteria&quot;: [{&quot;sourceFieldName&quot;: &quot;Id&quot;,&quot;operator&quot;: &quot;NotEquals&quot;,&quot;value&quot;: &quot;0&quot;,&quot;sequence&quot;: 1}]}</defaultValue>
        <description>The Program Rebate Type Filter that’s provided as a parameter.</description>
        <isMultiValue>false</isMultiValue>
        <label>Program Rebate Type Filter</label>
        <name>ProgramRebateTypeFilter</name>
    </parameters>
    <parameters>
        <dataType>Filter</dataType>
        <defaultValue>{&quot;filterCondition&quot;: &quot;1&quot;,&quot;criteria&quot;: [{&quot;sourceFieldName&quot;: &quot;Id&quot;,&quot;operator&quot;: &quot;NotEquals&quot;,&quot;value&quot;: &quot;0&quot;,&quot;sequence&quot;: 1}]}</defaultValue>
        <description>The Rebate Program Filter that’s provided as a parameter.</description>
        <isMultiValue>false</isMultiValue>
        <label>Rebate Program Filter</label>
        <name>RebateProgramFilter</name>
    </parameters>
    <parameters>
        <dataType>Filter</dataType>
        <defaultValue>{&quot;filterCondition&quot;: &quot;1&quot;,&quot;criteria&quot;: [{&quot;sourceFieldName&quot;: &quot;Id&quot;,&quot;operator&quot;: &quot;NotEquals&quot;,&quot;value&quot;: &quot;0&quot;,&quot;sequence&quot;: 1}]}</defaultValue>
        <description>The rebate program member filter that’s provided as a parameter.</description>
        <isMultiValue>false</isMultiValue>
        <label>Rebate Program Member Filter</label>
        <name>RebateProgramMemberFilter</name>
    </parameters>
    <parameters>
        <dataType>Filter</dataType>
        <defaultValue>{&quot;filterCondition&quot;: &quot;1&quot;,&quot;criteria&quot;: [{&quot;sourceFieldName&quot;: &quot;Id&quot;,&quot;operator&quot;: &quot;NotEquals&quot;,&quot;value&quot;: &quot;0&quot;,&quot;sequence&quot;: 1}]}</defaultValue>
        <description>The Rebate Program Payout Period Filter that’s provided as a parameter.</description>
        <isMultiValue>false</isMultiValue>
        <label>Rebate Program Payout Period Filter</label>
        <name>RebateProgramPayoutPeriodFilter</name>
    </parameters>
    <processType>Rebates</processType>
    <status>Active</status>
    <transforms>
        <description>Compare the generated unique ID for Aggregate Reference Number to the esixting unique Id, if present.</description>
        <expressionFields>
            <alias>GeneratedAggregateReferenceNumber</alias>
            <dataType>Text</dataType>
            <expression>IF(ISNULL({AggregateReferenceNumber} ) , {GeneratedAggregateReferenceNumberUUID}  ,{AggregateReferenceNumber} )</expression>
            <length>50</length>
        </expressionFields>
        <label>Compare Generated and Existing Aggregate Reference Number</label>
        <name>CompareGeneratedAndExistingAggregateReferenceNumber</name>
        <sourceName>GenerateAggregateReferenceNumberForAggregate</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <transforms>
        <description>Identifies new or updated records to be upserted into the Rebate Program Member Aggregate object.</description>
        <expressionFields>
            <alias>IsUpdateOrNew</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>1</decimalPlaces>
            <expression>IF(({TotalAggQuanity} == {TotalQuantity}) &amp;&amp; ({TotalAggAmount} == {TotalTransactionAmount}), 0,1)</expression>
            <length>2</length>
        </expressionFields>
        <label>Compute New Or Updated Aggregate Records</label>
        <name>ComputeNewOrUpdatedAggregateRecords</name>
        <sourceName>LookUpExistingAggregateData</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <transforms>
        <description>Identifies the transaction journal records that have an activity date greater than or equal to the start date, and less than the or equal to the end date of the payout period.</description>
        <expressionFields>
            <alias>IsValid</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>1</decimalPlaces>
            <expression>IF((DATEVALUE({ActivityDate}) &gt;= DATEVALUE({StartDate})) &amp;&amp; (DATEVALUE({ActivityDate}) &lt;= DATEVALUE({EndDate})), 1,0)</expression>
            <length>2</length>
        </expressionFields>
        <label>Compute Transaction Journals With Activity Dates</label>
        <name>ComputeTransactionJournalsWithActivityDates</name>
        <sourceName>AddRebateTypeAndPayoutPeriodToTransactionJournal</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <transforms>
        <description>Identifies valid transaction journals by applying rebate type filters.</description>
        <expressionFields>
            <alias>IsValidForFilter</alias>
            <dataType>Text</dataType>
            <expression>eval({FilterCriteria})</expression>
            <length>8</length>
        </expressionFields>
        <label>Compute Valid Transaction Journals Per Rebate Type</label>
        <name>ComputeValidTransactionJournalsPerRebateType</name>
        <sourceName>FilterJournalsForValidProducts</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <transforms>
        <description>Generates a unique ID to be populated in the Aggregate Reference Number field of the Rebate Member Product Aggregate object.</description>
        <expressionFields>
            <alias>GeneratedAggregateReferenceNumberUUID</alias>
            <dataType>Text</dataType>
            <expression>UUID()</expression>
            <length>50</length>
        </expressionFields>
        <label>Generate Aggregate Reference Number for Aggregate</label>
        <name>GenerateAggregateReferenceNumberForAggregate</name>
        <sourceName>ComputeNewOrUpdatedAggregateRecords</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <writebacks>
        <description>Upserts the transaction journal records with valid aggregate item records into the Rebate Member Aggrgate Item object.</description>
        <fields>
            <sourceFieldName>RebateMemberAggregateItemId</sourceFieldName>
            <targetFieldName>Id</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>TransactionJournalId</sourceFieldName>
            <targetFieldName>TransactionJournalId</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>TransactionAmount</sourceFieldName>
            <targetFieldName>TransactionAmount</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>Quantity</sourceFieldName>
            <targetFieldName>TransactionQuantity</targetFieldName>
        </fields>
        <fields>
            <parentName>RebateMemberProductAggregate</parentName>
            <relationshipName>RebateMemberProductAggregate</relationshipName>
            <sourceFieldName>AggregateReferenceNumber</sourceFieldName>
            <targetFieldName>AggregateReferenceNumber</targetFieldName>
        </fields>
        <isChangedRow>false</isChangedRow>
        <label>Upsert Aggregate Item Records</label>
        <name>UpsertAggregateItemRecords</name>
        <operationType>Upsert</operationType>
        <sourceName>FilterValidAggregateItem</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>RebateMemberAggregateItem</targetObjectName>
        <writebackSequence>2</writebackSequence>
        <writebackUser>005Hr00000EirARIAZ</writebackUser>
    </writebacks>
    <writebacks>
        <description>Upserts the total transaction amount and total quantity from the TotalTransactionAmountAndTotalQuantity node to Rebate Member Product Aggregate.</description>
        <fields>
            <sourceFieldName>Id</sourceFieldName>
            <targetFieldName>Id</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>TotalAggAmount</sourceFieldName>
            <targetFieldName>TotalTransactionAmount</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>TotalAggQuanity</sourceFieldName>
            <targetFieldName>TotalQuantity</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>PayoutPeriodId</sourceFieldName>
            <targetFieldName>RebateProgramPayoutPeriodId</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>MemberId</sourceFieldName>
            <targetFieldName>RebateProgramMemberId</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>RebateTypeId</sourceFieldName>
            <targetFieldName>ProgramRebateTypeId</targetFieldName>
        </fields>
        <fields>
            <sourceFieldName>GeneratedAggregateReferenceNumber</sourceFieldName>
            <targetFieldName>AggregateReferenceNumber</targetFieldName>
        </fields>
        <isChangedRow>false</isChangedRow>
        <label>Upsert Total Transaction Amount and Total Quantity</label>
        <name>UpsertTotalTransactionAmountAndQuantity</name>
        <operationType>Upsert</operationType>
        <sourceName>FilterNewOrUpdatedAggregateRecords</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>RebateMemberProductAggregate</targetObjectName>
        <writebackSequence>1</writebackSequence>
        <writebackUser>005Hr00000EirARIAZ</writebackUser>
    </writebacks>
</BatchCalcJobDefinition>
